<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <title>Sistema de Funcionรกrios</title>
ย ย <style>
ย ย ย ย body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
ย ย ย ย h1 { text-align: center; }
ย ย ย ย #searchBar { display: block; margin: 20px auto; padding: 10px; width: 50%; border: 1px solid #ccc; border-radius: 5px; }
ย ย ย ย table { 
ย ย ย ย ย ย width: 100%; 
ย ย ย ย ย ย border-collapse: collapse; 
ย ย ย ย ย ย margin-top: 10px; 
ย ย ย ย ย ย background: #fff;
ย ย ย ย ย ย margin-bottom: 80px; /* Adicionado para evitar sobreposiรงรฃo */
ย ย ย ย }
ย ย ย ย table, th, td { border: 1px solid #ddd; text-align: center; }
ย ย ย ย th, td { padding: 12px; }
ย ย ย ย #addEmployee { position: fixed; bottom: 20px; left: 20px; padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; }
ย ย ย ย #totalEmployees { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 10px 15px; border-radius: 8px; display: flex; align-items: center; gap: 8px; cursor: pointer; }
ย ย ย ย #reloadPunishments { background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; padding: 4px 8px; }
ย ย ย ย #formContainer, #profileContainer, #roleCountContainer { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 2px solid #444; border-radius: 10px; box-shadow: 0px 5px 10px rgba(0,0,0,0.3); width: 400px; max-height: 80%; overflow-y: auto; }
ย ย ย ย #formContainer input, #formContainer select, #profileContainer input, #profileContainer select { display: block; margin: 10px 0; padding: 8px; width: 95%; }
ย ย ย ย #formContainer button, #profileContainer button, #roleCountContainer button { margin-top: 10px; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; }
ย ย ย ย .editBtn { background: none; border: 1px solid #333; padding: 5px; border-radius: 4px; cursor: pointer; }
ย ย ย ย .deleteBtn { background: #ff4d4d; color: white; border: none; border-radius: 4px; padding: 5px 8px; cursor: pointer; font-size: 14px; margin-left: 5px; }
ย ย ย ย .removePunishmentBtn { background: none; color: red; border: none; font-size: 16px; cursor: pointer; padding: 0 5px; }
ย ย ย ย .punishmentItem { display: flex; justify-content: space-between; align-items: center; margin: 5px 0; padding: 5px; background: #f9f9f9; border: 1px solid #ccc; border-radius: 5px; }
ย ย ย ย .punishmentItem span { flex-grow: 1; }
ย ย ย ย .punishmentItem input[type=checkbox] { cursor: pointer; }
ย ย </style>
</head>
<body>
ย ย <h1>Gerenciamento de Funcionรกrios</h1>
ย ย <input type="text" id="searchBar" placeholder="Pesquisar por Nome ou ID...">

ย ย <table id="employeeTable">
ย ย ย ย <thead>
ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย <th>ID</th>
ย ย ย ย ย ย ย ย <th>Nome</th>
ย ย ย ย ย ย ย ย <th>Cargo</th>
ย ย ย ย ย ย ย ย <th>Aรงรตes</th>
ย ย ย ย ย ย ย ย <th>โ๏ธ Pendรชncias</th>
ย ย ย ย ย ย </tr>
ย ย ย ย </thead>
ย ย ย ย <tbody></tbody>
ย ย </table>

ย ย <button id="addEmployee">+ Cadastrar Funcionรกrio</button>
ย ย <div id="totalEmployees">
ย ย ย ย <span>Total 0</span>
ย ย ย ย <button id="reloadPunishments">๐</button>
ย ย </div>

ย ย <div id="formContainer">
ย ย ย ย <h3>Novo Funcionรกrio</h3>
ย ย ย ย <input type="text" id="idInput" placeholder="ID">
ย ย ย ย <input type="text" id="nameInput" placeholder="Nome">
ย ย ย ย <select id="roleInput">
ย ย ย ย ย ย <option value="">Selecione o Cargo</option>
ย ย ย ย ย ย <option>Atendente</option>
ย ย ย ย ย ย <option>Caixa</option>
ย ย ย ย ย ย <option>Garรงom</option>
ย ย ย ย ย ย <option>Cozinheiro</option>
ย ย ย ย ย ย <option>Supervisor</option>
ย ย ย ย ย ย <option>Gerente</option>
ย ย ย ย </select>
ย ย ย ย <button id="saveBtn">Salvar</button>
ย ย ย ย <button id="cancelBtn">Cancelar</button>
ย ย </div>

ย ย <div id="profileContainer">
ย ย ย ย <h3 id="profileName"></h3>
ย ย ย ย <p><b>ID:</b> <span id="profileId"></span></p>
ย ย ย ย <p><b>Cargo:</b> <span id="profileRole"></span></p>
ย ย ย ย <h4>Histรณrico de Puniรงรตes</h4>
ย ย ย ย <div id="punishmentList">Sem puniรงรตes.</div>
ย ย ย ย <select id="punishmentSelect">
ย ย ย ย ย ย <option value="">Selecione uma puniรงรฃo</option>
ย ย ย ย ย ย <option>Infraรงรฃo</option>
ย ย ย ย ย ย <option>Primeira Puniรงรฃo</option>
ย ย ย ย ย ย <option>Segunda Puniรงรฃo</option>
ย ย ย ย ย ย <option>Terceira Puniรงรฃo</option>
ย ย ย ย </select>
ย ย ย ย <button id="addPunishmentBtn">Adicionar Puniรงรฃo</button>
ย ย ย ย <br><br>
ย ย ย ย <button id="closeProfileBtn">Fechar</button>
ย ย </div>

ย ย <div id="roleCountContainer">
ย ย ย ย <h3>Funcionรกrios por Cargo</h3>
ย ย ย ย <div id="roleCountList"></div>
ย ย ย ย <button id="closeRoleCountBtn">Fechar</button>
ย ย </div>

ย ย <audio id="addSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
ย ย <audio id="deleteSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
ย ย <audio id="errorSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
ย ย <audio id="confirmSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
ย ย <audio id="checkSound" src="https://actions.google.com/sounds/v1/cartoon/wood_peck.ogg"></audio>

ย ย <script type="module">
ย ย ย ย import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
ย ย ย ย import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

ย ย ย ย // ๐ Suas credenciais Firebase (da imagem)
ย ย ย ย const firebaseConfig = {
ย ย ย ย ย ย apiKey: "AIzaSyBnyjI-ap6yoc-dXN9wEHF61dS",
ย ย ย ย ย ย authDomain: "gerenciamento-do-restaurante.firebaseapp.com",
ย ย ย ย ย ย projectId: "gerenciamento-do-restaurante",
ย ย ย ย ย ย storageBucket: "gerenciamento-do-restaurante.appspot.com",
ย ย ย ย ย ย messagingSenderId: "986880886198",
ย ย ย ย ย ย appId: "1:986880886198:web:2f6b083e648d85a72b",
ย ย ย ย ย ย measurementId: "G-HEN29KHLQP"
ย ย ย ย };

ย ย ย ย const app = initializeApp(firebaseConfig);
ย ย ย ย const db = getFirestore(app);
ย ย ย ย const employeesCollection = collection(db, "employees");

ย ย ย ย let employees = [];
ย ย ย ย let currentProfileId = null;

ย ย ย ย const roleOrder = {
ย ย ย ย ย ย Gerente: 6,
ย ย ย ย ย ย Supervisor: 5,
ย ย ย ย ย ย Cozinheiro: 4,
ย ย ย ย ย ย Garรงom: 3,
ย ย ย ย ย ย Caixa: 2,
ย ย ย ย ย ย Atendente: 1
ย ย ย ย };

ย ย ย ย const elements = {
ย ย ย ย ย ย tableBody: document.querySelector("#employeeTable tbody"),
ย ย ย ย ย ย totalEmployeesSpan: document.getElementById("totalEmployees").querySelector("span"),
ย ย ย ย ย ย searchBar: document.getElementById("searchBar"),
ย ย ย ย ย ย addEmployeeBtn: document.getElementById("addEmployee"),
ย ย ย ย ย ย reloadPunishmentsBtn: document.getElementById("reloadPunishments"),
ย ย ย ย ย ย totalEmployeesDiv: document.getElementById("totalEmployees"),
ย ย ย ย ย ย formContainer: document.getElementById("formContainer"),
ย ย ย ย ย ย profileContainer: document.getElementById("profileContainer"),
ย ย ย ย ย ย roleCountContainer: document.getElementById("roleCountContainer"),
ย ย ย ย ย ย idInput: document.getElementById("idInput"),
ย ย ย ย ย ย nameInput: document.getElementById("nameInput"),
ย ย ย ย ย ย roleInput: document.getElementById("roleInput"),
ย ย ย ย ย ย saveBtn: document.getElementById("saveBtn"),
ย ย ย ย ย ย cancelBtn: document.getElementById("cancelBtn"),
ย ย ย ย ย ย profileName: document.getElementById("profileName"),
ย ย ย ย ย ย profileId: document.getElementById("profileId"),
ย ย ย ย ย ย profileRole: document.getElementById("profileRole"),
ย ย ย ย ย ย punishmentList: document.getElementById("punishmentList"),
ย ย ย ย ย ย punishmentSelect: document.getElementById("punishmentSelect"),
ย ย ย ย ย ย addPunishmentBtn: document.getElementById("addPunishmentBtn"),
ย ย ย ย ย ย closeProfileBtn: document.getElementById("closeProfileBtn"),
ย ย ย ย ย ย roleCountList: document.getElementById("roleCountList"),
ย ย ย ย ย ย closeRoleCountBtn: document.getElementById("closeRoleCountBtn"),
ย ย ย ย ย ย addSound: document.getElementById("addSound"),
ย ย ย ย ย ย deleteSound: document.getElementById("deleteSound"),
ย ย ย ย ย ย errorSound: document.getElementById("errorSound"),
ย ย ย ย ย ย checkSound: document.getElementById("checkSound")
ย ย ย ย };

ย ย ย ย function renderEmployees(filter = "") {
ย ย ย ย ย ย elements.tableBody.innerHTML = "";
ย ย ย ย ย ย let filtered = employees
ย ย ย ย ย ย ย ย .filter(emp =>
ย ย ย ย ย ย ย ย ย ย emp.name.toLowerCase().includes(filter.toLowerCase()) ||
ย ย ย ย ย ย ย ย ย ย emp.id.toLowerCase().includes(filter.toLowerCase())
ย ย ย ย ย ย ย ย )
ย ย ย ย ย ย ย ย .sort((a, b) => roleOrder[b.role] - roleOrder[a.role]);

ย ย ย ย ย ย filtered.forEach((emp) => {
ย ย ย ย ย ย ย ย let pendencias = emp.punishments.filter(p => !p.applied).map(p => `${p.type}`);
ย ย ย ย ย ย ย ย let pendenciaText = pendencias.length > 0 ? pendencias.join(", ") : "Nenhuma";
ย ย ย ย ย ย ย ย let row = `
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${emp.id}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td><a href="#" onclick="window.openProfile('${emp.idDoc}')">${emp.name}</a></td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${emp.role}</td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="editBtn" onclick="window.editEmployee('${emp.idDoc}')">โ๏ธ</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="deleteBtn" onclick="window.deleteEmployee('${emp.idDoc}')">X</button>
ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย <td>${pendenciaText}</td>
ย ย ย ย ย ย ย ย ย ย </tr>`;
ย ย ย ย ย ย ย ย elements.tableBody.innerHTML += row;
ย ย ย ย ย ย });
ย ย ย ย ย ย elements.totalEmployeesSpan.innerText = `Total ${employees.length}`;
ย ย ย ย }

ย ย ย ย function renderPunishments() {
ย ย ย ย ย ย let emp = employees.find(e => e.idDoc === currentProfileId);
ย ย ย ย ย ย elements.punishmentList.innerHTML = "";
ย ย ย ย ย ย if (emp.punishments.length === 0) {
ย ย ย ย ย ย ย ย elements.punishmentList.innerText = "Sem puniรงรตes.";
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย emp.punishments.forEach((p, i) => {
ย ย ย ย ย ย ย ย ย ย let div = document.createElement("div");
ย ย ย ย ย ย ย ย ย ย div.className = "punishmentItem";
ย ย ย ย ย ย ย ย ย ย div.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <span>${p.type}</span>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="checkbox" ${p.applied ? "checked" : ""} onchange="window.toggleApplied('${currentProfileId}', ${i})">
ย ย ย ย ย ย ย ย ย ย ย ย <button class="removePunishmentBtn" onclick="window.removePunishment('${currentProfileId}', ${i})">X</button>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย elements.punishmentList.appendChild(div);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function renderRoleCount() {
ย ย ย ย ย ย let roleCount = { Gerente: 0, Supervisor: 0, Cozinheiro: 0, Garรงom: 0, Caixa: 0, Atendente: 0 };
ย ย ย ย ย ย employees.forEach(emp => {
ย ย ย ย ย ย ย ย if (roleCount[emp.role] !== undefined) {
ย ย ย ย ย ย ย ย ย ย roleCount[emp.role]++;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย ย ย elements.roleCountList.innerHTML = "";
ย ย ย ย ย ย for (let role in roleCount) {
ย ย ย ย ย ย ย ย elements.roleCountList.innerHTML += `<p><b>${role}:</b> ${roleCount[role]}</p>`;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function clearForm() {
ย ย ย ย ย ย elements.idInput.value = "";
ย ย ย ย ย ย elements.nameInput.value = "";
ย ย ย ย ย ย elements.roleInput.value = "";
ย ย ย ย }

ย ย ย ย window.openForm = (isEditing = false) => {
ย ย ย ย ย ย elements.formContainer.style.display = "block";
ย ย ย ย ย ย document.querySelector("#formContainer h3").innerText = isEditing ? "Editar Funcionรกrio" : "Novo Funcionรกrio";
ย ย ย ย };

ย ย ย ย window.closeForm = () => {
ย ย ย ย ย ย elements.formContainer.style.display = "none";
ย ย ย ย ย ย clearForm();
ย ย ย ย };

ย ย ย ย window.openProfile = (idDoc) => {
ย ย ย ย ย ย currentProfileId = idDoc;
ย ย ย ย ย ย let emp = employees.find(e => e.idDoc === idDoc);
ย ย ย ย ย ย elements.profileName.innerText = emp.name;
ย ย ย ย ย ย elements.profileId.innerText = emp.id;
ย ย ย ย ย ย elements.profileRole.innerText = emp.role;
ย ย ย ย ย ย renderPunishments();
ย ย ย ย ย ย elements.profileContainer.style.display = "block";
ย ย ย ย };

ย ย ย ย window.closeProfile = () => {
ย ย ย ย ย ย elements.profileContainer.style.display = "none";
ย ย ย ย };

ย ย ย ย window.closeRoleCount = () => {
ย ย ย ย ย ย elements.roleCountContainer.style.display = "none";
ย ย ย ย };

ย ย ย ย // Event Listeners
ย ย ย ย elements.addEmployeeBtn.addEventListener("click", () => {
ย ย ย ย ย ย window.openForm();
ย ย ย ย });

ย ย ย ย elements.cancelBtn.addEventListener("click", () => {
ย ย ย ย ย ย window.closeForm();
ย ย ย ย });

ย ย ย ย elements.totalEmployeesDiv.addEventListener("click", () => {
ย ย ย ย ย ย renderRoleCount();
ย ย ย ย ย ย elements.roleCountContainer.style.display = "block";
ย ย ย ย });

ย ย ย ย elements.closeRoleCountBtn.addEventListener("click", () => {
ย ย ย ย ย ย window.closeRoleCount();
ย ย ย ย });

ย ย ย ย elements.saveBtn.addEventListener("click", async () => {
ย ย ย ย ย ย let id = elements.idInput.value;
ย ย ย ย ย ย let name = elements.nameInput.value;
ย ย ย ย ย ย let role = elements.roleInput.value;
ย ย ย ย ย ย let existingIdDoc = elements.saveBtn.dataset.idDoc;

ย ย ย ย ย ย if (id && name && role) {
ย ย ย ย ย ย ย ย if (existingIdDoc) {
ย ย ย ย ย ย ย ย ย ย await updateDoc(doc(db, "employees", existingIdDoc), { id, name, role });
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย await addDoc(employeesCollection, { id, name, role, punishments: [] });
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย elements.addSound.play();
ย ย ย ย ย ย ย ย window.closeForm();
ย ย ย ย ย ย ย ย delete elements.saveBtn.dataset.idDoc;
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย alert("Preencha todos os campos!");
ย ย ย ย ย ย ย ย elements.errorSound.play();
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย elements.reloadPunishmentsBtn.addEventListener("click", async () => {
ย ย ย ย ย ย if (confirm("Deseja remover TODAS as puniรงรตes de todos os funcionรกrios?")) {
ย ย ย ย ย ย ย ย for (let emp of employees) {
ย ย ย ย ย ย ย ย ย ย await updateDoc(doc(db, "employees", emp.idDoc), { punishments: [] });
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย elements.addPunishmentBtn.addEventListener("click", async () => {
ย ย ย ย ย ย let type = elements.punishmentSelect.value;
ย ย ย ย ย ย let emp = employees.find(e => e.idDoc === currentProfileId);

ย ย ย ย ย ย if (type === "Infraรงรฃo" && ["Garรงom", "Cozinheiro", "Supervisor", "Gerente"].includes(emp.role)) {
ย ย ย ย ย ย ย ย alert("Erro: O funcionรกrio nรฃo pode receber esse tipo de puniรงรฃo.");
ย ย ย ย ย ย ย ย elements.errorSound.play();
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ย if (type) {
ย ย ย ย ย ย ย ย let newPunishments = [...emp.punishments, { type, applied: false }];
ย ย ย ย ย ย ย ย await updateDoc(doc(db, "employees", emp.idDoc), { punishments: newPunishments });
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย alert("Selecione um tipo de puniรงรฃo!");
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย elements.closeProfileBtn.addEventListener("click", () => {
ย ย ย ย ย ย window.closeProfile();
ย ย ย ย });

ย ย ย ย elements.searchBar.addEventListener("input", (e) => {
ย ย ย ย ย ย renderEmployees(e.target.value);
ย ย ย ย });

ย ย ย ย // Global functions (accessible from HTML)
ย ย ย ย window.editEmployee = (idDoc) => {
ย ย ย ย ย ย let emp = employees.find(e => e.idDoc === idDoc);
ย ย ย ย ย ย elements.idInput.value = emp.id;
ย ย ย ย ย ย elements.nameInput.value = emp.name;
ย ย ย ย ย ย elements.roleInput.value = emp.role;
ย ย ย ย ย ย elements.saveBtn.dataset.idDoc = idDoc;
ย ย ย ย ย ย window.openForm(true);
ย ย ย ย };

ย ย ย ย window.deleteEmployee = async (idDoc) => {
ย ย ย ย ย ย if (confirm("Deseja remover este funcionรกrio?")) {
ย ย ย ย ย ย ย ย await deleteDoc(doc(db, "employees", idDoc));
ย ย ย ย ย ย ย ย elements.deleteSound.play();
ย ย ย ย ย ย }
ย ย ย ย };

ย ย ย ย window.removePunishment = async (idDoc, index) => {
ย ย ย ย ย ย let emp = employees.find(e => e.idDoc === idDoc);
ย ย ย ย ย ย let newPunishments = [...emp.punishments];
ย ย ย ย ย ย newPunishments.splice(index, 1);
ย ย ย ย ย ย await updateDoc(doc(db, "employees", idDoc), { punishments: newPunishments });
ย ย ย ย ย ย elements.deleteSound.play();
ย ย ย ย };

ย ย ย ย window.toggleApplied = async (idDoc, index) => {
ย ย ย ย ย ย let emp = employees.find(e => e.idDoc === idDoc);
ย ย ย ย ย ย let newPunishments = [...emp.punishments];
ย ย ย ย ย ย newPunishments[index].applied = !newPunishments[index].applied;
ย ย ย ย ย ย await updateDoc(doc(db, "employees", idDoc), { punishments: newPunishments });
ย ย ย ย ย ย elements.checkSound.play();
ย ย ย ย };

ย ย ย ย // Real-time listener
ย ย ย ย onSnapshot(employeesCollection, (snapshot) => {
ย ย ย ย ย ย employees = [];
ย ย ย ย ย ย snapshot.forEach(docSnap => {
ย ย ย ย ย ย ย ย employees.push({ idDoc: docSnap.id, ...docSnap.data() });
ย ย ย ย ย ย });
ย ย ย ย ย ย renderEmployees(elements.searchBar.value);
ย ย ย ย ย ย if (elements.profileContainer.style.display === "block") {
ย ย ย ย ย ย ย ย renderPunishments();
ย ย ย ย ย ย }
ย ย ย ย });
ย ย </script>
</body>
</html>
