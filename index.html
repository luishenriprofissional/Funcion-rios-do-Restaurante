<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Funcionários</title>
<style>
  body { font-family: Arial, sans-serif; margin:20px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f0f0f0; }
  .employeeRow.yellow { background-color: #fff8b3; }          /* amarelo */
  .employeeRow.orange { background-color: #ffcc80; }          /* laranja */
  .employeeRow.orangeRed { background-color: #ff9966; }       /* laranja-avermelhado */
  .employeeRow.red { background-color: #ff6666; }             /* vermelho */
  .profileSection { margin-top: 20px; border: 1px solid #ccc; padding: 15px; }
  .punishmentItem { display: flex; align-items: center; margin-bottom: 5px; gap:5px; }
  .removePunishmentBtn { background: none; border: none; color: red; font-weight: bold; cursor: pointer; }
  .editBtn, .deleteBtn { margin-right: 5px; }
</style>
</head>
<body>

<h1>Sistema de Funcionários</h1>

<button onclick="showAddForm()">+ Adicionar Funcionário</button>

<div id="employeeList"></div>

<div class="profileSection" id="profileSection" style="display:none;">
  <h2 id="profileName"></h2>
  <p><strong>Cargo:</strong> <span id="profileRole"></span></p>
  <h3>Histórico de Punições</h3>
  <div id="punishmentList"></div>
</div>

<!-- Sons -->
<audio id="confirmSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

<script>
let employees = JSON.parse(localStorage.getItem("employees") || "[]");
let currentProfileIndex = null;

function showAddForm() {
  const name = prompt("Nome do funcionário:");
  const role = prompt("Cargo (Gerente, Supervisor, Cozinheiro, Garçom, Caixa, Atendente):");
  if (name && role) {
    employees.push({id: Date.now(), name, role, punishments: []});
    localStorage.setItem("employees", JSON.stringify(employees));
    renderEmployees();
  }
}

function renderEmployees() {
  // Ordenar cargos conforme prioridade
  const priority = ["Gerente", "Supervisor", "Cozinheiro", "Garçom", "Caixa", "Atendente"];
  const sorted = [...employees].sort((a,b)=> priority.indexOf(a.role)-priority.indexOf(b.role));
  let html = `<table>
  <tr><th>Nome</th><th>Cargo</th><th>Ações</th></tr>`;
  sorted.forEach((emp, i) => {
    // definir cor da linha conforme histórico
    let cls = getRowClass(emp.punishments);
    html += `<tr class="employeeRow ${cls}">
      <td onclick="openProfile(${employees.indexOf(emp)})">${emp.name}</td>
      <td>${emp.role}</td>
      <td>
        <button class="editBtn" onclick="editEmployee(${employees.indexOf(emp)})">Editar</button>
        <button class="deleteBtn" onclick="deleteEmployee(${employees.indexOf(emp)})">Remover</button>
      </td>
    </tr>`;
  });
  html += `</table>`;
  document.getElementById("employeeList").innerHTML = html;
}

function getRowClass(punishments){
  const types = punishments.map(p=>p.type);
  // Sem punições
  if (types.length===0) return "";
  // Apenas infração
  if (types.length===1 && types.includes("Infração")) return "yellow";
  // Terceira punição
  if (types.includes("Terceira Punição")) return "red";
  // Infração + Primeira OU Primeira+Segunda
  if ((types.includes("Infração") && types.includes("Primeira Punição")) ||
      (types.includes("Primeira Punição") && types.includes("Segunda Punição"))) return "orange";
  // Infração + Primeira + Segunda
  if (types.includes("Infração") && types.includes("Primeira Punição") && types.includes("Segunda Punição")) return "orangeRed";
  return "";
}

function openProfile(index){
  currentProfileIndex = index;
  const emp = employees[index];
  document.getElementById("profileName").innerText = emp.name;
  document.getElementById("profileRole").innerText = emp.role;
  renderPunishments();
  document.getElementById("profileSection").style.display="block";
}

function renderPunishments(){
  let emp = employees[currentProfileIndex];
  let container = document.getElementById("punishmentList");
  container.innerHTML="";
  if (emp.punishments.length===0){
    container.innerText="Sem punições.";
  } else {
    emp.punishments.forEach((p,i)=>{
      let div = document.createElement("div");
      div.className="punishmentItem";
      div.innerHTML=`
        <span>${p.type}</span>
        <input type="checkbox" ${p.applied ? "checked disabled":""} onchange="toggleApplied(${i})">
        <button class="removePunishmentBtn" onclick="removePunishment(${i})">X</button>
      `;
      container.appendChild(div);
    });
  }
}

function toggleApplied(i){
  if (!employees[currentProfileIndex].punishments[i].applied){
    employees[currentProfileIndex].punishments[i].applied=true;
    localStorage.setItem
